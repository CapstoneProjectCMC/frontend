<div class="content-container">
  <div class="filter-table">
    <div class="control">
      <div class="filter">
        <app-input
          placeholder="Nhập tên..."
          [value]="username"
          (valueChange)="handleInputChange($event)"
          [required]="false"
          [minLength]="3"
          [variant]="'primary'"
          [isSvg]="false"
          [icon]="'fa fa-search'"
        ></app-input>
        <app-dropdown-button
          [label]="'Vai trò'"
          [options]="role"
          [variant]="'secondary'"
          [size]="'small'"
          [customDropField]="'main-type'"
          [disabled]="false"
          [multiSelect]="true"
          [isDisplayCheckbox]="false"
          (onSelect)="handleSelect('role', $event)"
          [isOpen]="activeDropdown === 'role'"
          (toggle)="toggleDropdown('role')"
          [isDisplaySelectedOpptionLabels]="true"
          [isButtonControl]="true"
          [isSearchable]="true"
          [minHeight]="true"
          [needIndexColor]="true"
        ></app-dropdown-button>
        <app-dropdown-button
          [label]="'Trạng thái'"
          [options]="status"
          [variant]="'secondary'"
          [size]="'small'"
          [customDropField]="'main-type'"
          [disabled]="false"
          [multiSelect]="true"
          [isDisplayCheckbox]="false"
          (onSelect)="handleSelect('status', $event)"
          [isOpen]="activeDropdown === 'status'"
          (toggle)="toggleDropdown('status')"
          [isDisplaySelectedOpptionLabels]="true"
          [isButtonControl]="true"
          [isSearchable]="true"
          [minHeight]="true"
          [needIndexColor]="true"
        ></app-dropdown-button>
      </div>
      <div class="button-user">
        <app-button
          (onClick)="handleImport()"
          [width]="'50px'"
          [height]="'50px'"
          variant="solid"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-file-down-icon lucide-file-down"
          >
            <path
              d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"
            />
            <path d="M14 2v4a2 2 0 0 0 2 2h4" />
            <path d="M12 18v-6" />
            <path d="m9 15 3 3 3-3" />
          </svg>
        </app-button>
        <app-button
          (onClick)="handleImport()"
          [width]="'50px'"
          [height]="'50px'"
          variant="solid"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-file-up-icon lucide-file-up"
          >
            <path
              d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"
            />
            <path d="M14 2v4a2 2 0 0 0 2 2h4" />
            <path d="M12 12v6" />
            <path d="m15 15-3-3-3 3" />
          </svg>
        </app-button>
        <app-button
          (onClick)="handleAdd()"
          [width]="'50px'"
          [height]="'50px'"
          variant="outline"
        >
          <span style="font-size: 24px">+</span>
        </app-button>
      </div>
    </div>

    <app-table
      [headers]="headers"
      [data]="ListUser"
      [amountDataPerPage]="10"
      [needNo]="true"
      [needDelete]="false"
      [needEdit]="false"
      [needViewResult]="false"
      [needswitch]="true"
      [onSwitchClick]="handleSwitch"
      [switchField]="'status'"
      [lockValue]="0"
      [openValue]="1"
    >
      <!-- Avatar + DisplayName + Popup Links -->
      <ng-template #cell_displayName let-row let-i="rowIndex">
        <div style="display: flex; align-items: center; position: relative">
          <img
            *ngIf="row.avatarUrl!=null"
            [src]="row.avatarUrl"
            alt="avatar"
            width="36"
            height="36"
            style="border-radius: 50%; margin-right: 8px"
          />
          <span
            (click)="onDisplayNameClick(row)"
            style="cursor: pointer; font-weight: 600"
          >
            {{ row.displayName }}
          </span>
        </div>
      </ng-template>

      <!-- Ngày sinh -->
      <ng-template #cell_dob let-row> {{ row.dob }} </ng-template>

      <!-- Vai trò -->
      <ng-template #cell_role let-row>
        <span>
          {{ row.role === 0 ? 'Học sinh' : row.role === 1 ? 'Admin tổ chức' :
          row.role === 2 ? 'Giáo viên' : 'Khác' }}
        </span>
      </ng-template>

      <!-- Trạng thái -->
      <ng-template #cell_status let-row>
        <span [style.color]="row.status === 1 ? 'green' : 'red'">
          {{ row.status === 1 ? 'Active' : 'Blocked' }}
        </span>
      </ng-template>
    </app-table>
  </div>

  <!-- Overlay Profile Popup -->
  <div
    *ngIf="openedUser"
    [ngClass]="{'profile-popup-overlay': true, 'hide': isClosing}"
  >
    <div
      class="profile-popup-backdrop"
      [ngClass]="{'hide': isClosing}"
      (click)="closeProfilePopup()"
    ></div>
    <div [ngClass]="{'profile-popup-container': true, 'hide': isClosing}">
      <button class="close-btn" (click)="closeProfilePopup()">×</button>
      <app-profile-popup [user]="openedUser"></app-profile-popup>
    </div>
  </div>

  <app-pagination
    [totalData]="ListUser.length"
    [amountDataPerPage]="10"
    [currentPageIndex]=" 1"
    (onPageChange)="handlePageChange($event)"
  ></app-pagination>
</div>
