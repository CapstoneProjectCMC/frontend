<div class="resource-detail-container">
  <div
    class="resource-detail-video"
    [ngClass]="{
      'video': !isDocument,
      'document': isDocument
    }"
  >
    <!-- Nếu là Document thì đưa Info lên trước -->
    <div class="resource-video-info">
      <div class="title">{{ resource.fileName }}</div>
      <div class="author-action">
        <div class="author">
          <div class="avatar">
            <img
              [src]="resource.userProfile.avatarUrl || avatarDefault"
              alt="Avatar"
            />
          </div>
          <div class="name">{{authorName}}</div>
        </div>
        <!-- <div class="action">
          <div class="report">
            <span>Báo cáo</span>
          </div>
          <div class="save">
            <span>Lưu</span>
          </div>
        </div> -->
      </div>
      <div class="tag-description">
        <div class="resource-tags">
          @for (tag of resource.tags; track tag) {
          <span class="resource-tag"> #{{ tag.name }} </span>
          }
        </div>
      </div>
    </div>

    <div class="resource-content">
      <!-- Nếu là video -->
      @if (!isDocument && !isImage && resource.hlsUrl) {
      <app-video-player [videoSrc]="resource.hlsUrl || ''"></app-video-player>
      } @else {
      <!-- Nếu là document -->
      @if (isDocument) {
      <div class="document-view">
        @if (resource.fileName.endsWith('.pdf')) {
        <!-- PDF xem trực tiếp -->
        <iframe
          [src]="safeUrl"
          width="100%"
          height="600px"
          frameborder="0"
        ></iframe>
        } @else {
        <!-- File Word hoặc định dạng không hỗ trợ -->
        <div class="download-message">
          <p>Tệp này không thể hiển thị trực tiếp. Tệp đã được tải xuống.</p>
          <a [href]="resource.url" download class="download-link">
            Tải xuống {{ resource.fileName }}
          </a>
        </div>
        }

        <div class="resource-detail-content">
          <markdown [data]="resource.description"></markdown>
        </div>
      </div>
      }

      <!-- Nếu là image -->
      @if (isImage) {
      <div class="image-view">
        <img
          [src]="resource.url"
          [alt]="resource.fileName"
          class="resource-image"
        />
        <div class="resource-detail-content">
          <markdown [data]="resource.description"></markdown>
        </div>
      </div>
      } }
    </div>

    <!-- Nếu là Video thì info + comment vẫn nằm dưới như cũ -->
    @if (!isDocument) {
    <div class="resource-video-info">
      <!-- giữ nguyên phần info -->
    </div>
    }
  </div>

  <!-- Ẩn Other video nếu là Document -->
  @if (!isDocument) {
  <div class="resource-detail-another-video">
    <div class="input-title">
      <app-input
        label="Tìm kiếm video khác"
        placeholder="Nhập từ khóa tìm kiếm..."
        [value]="searchTerm"
        (valueChange)="handleInputChange($event)"
        [minLength]="3"
        [variant]="'primary'"
        [errorMessage]="searchTermError"
        [isSvg]="true"
      ></app-input>
    </div>
    <div class="list-resource-card-container">
      @if (!isLoading && listResource) {
      <div class="list-resource-card">
        @for (resource of listResource; track resource) {
        <div>
          <app-resource-card
            [resource]="resource"
            [showControls]="false"
            (main)="goToDetail($event)"
          ></app-resource-card>
        </div>
        }
      </div>
      } @if (isLoading) {
      <div class="list-resource-card">
        <app-skeleton-loading type="card" [count]="8"></app-skeleton-loading>
      </div>
      }
    </div>
  </div>
  }
</div>
