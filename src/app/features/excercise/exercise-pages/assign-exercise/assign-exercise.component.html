<div class="assign-container theme-light" *ngIf="!isLoading; else loadingState">
  <h1 class="title">
    Giao bài tập: <span class="exercise-name">{{ exerciseName }}</span>
  </h1>

  <div class="main-content">
    <div class="student-panel">
      <div class="panel-header">
        <h2>Danh sách học sinh</h2>
        <div class="search-bar">
          <i class="fa fa-search"></i>
          <input
            type="text"
            placeholder="Tìm kiếm theo tên, email..."
            [(ngModel)]="searchTerm"
            (input)="filterAvailableStudents()"
          />
        </div>
      </div>
      <div class="student-list">
        <ng-container
          *ngIf="availableStudents.length > 0; else emptyAvailableState"
        >
          <div
            class="student-card"
            *ngFor="let student of availableStudents"
            (click)="selectStudent(student)"
          >
            <img
              [src]="student.avatarUrl || avatarUrlDefault"
              alt="Avatar"
              class="avatar"
            />
            <div class="student-info">
              <span class="name">{{ student.displayName }}</span>
              <span class="email">{{ student.email }}</span>
            </div>
            <button class="action-btn add-btn" title="Thêm học sinh">
              <i class="fa fa-plus"></i>
            </button>
          </div>
        </ng-container>
      </div>
    </div>

    <div class="student-panel selected-panel">
      <div class="panel-header">
        <h2>
          Đã chọn <span class="count">({{ selectedStudents.length }})</span>
        </h2>
      </div>
      <div class="student-list">
        <ng-container
          *ngIf="selectedStudents.length > 0; else emptySelectedState"
        >
          <div class="student-card" *ngFor="let student of selectedStudents">
            <img
              [src]="student.avatarUrl || avatarUrlDefault"
              alt="Avatar"
              class="avatar"
            />
            <div class="student-info">
              <span class="name">{{ student.displayName }}</span>
              <span class="email">{{ student.email }}</span>
            </div>
            <button
              class="action-btn remove-btn"
              (click)="deselectStudent(student)"
              title="Bỏ chọn"
            >
              <i class="fa fa-times"></i>
            </button>
          </div>
        </ng-container>
      </div>
    </div>
  </div>

  <div class="actions-section">
    <div class="due-date-picker">
      <label for="due-date">Hạn nộp:</label>
      <input type="datetime-local" id="due-date" [(ngModel)]="dueAt" />
    </div>
    <button
      class="assign-button"
      [disabled]="selectedStudents.length === 0 || !dueAt"
      (click)="assignExercise()"
    >
      <i class="fa fa-paper-plane"></i>
      Giao bài
    </button>
  </div>
</div>

<ng-template #loadingState>
  <div class="skeleton-loader">
    <div class="skeleton skeleton-title"></div>

    <div class="main-content">
      <div class="student-panel">
        <div class="panel-header">
          <div
            class="skeleton skeleton-text"
            style="width: 60%; margin-bottom: 16px"
          ></div>
          <div class="skeleton skeleton-input"></div>
        </div>
        <div class="student-list">
          <div class="skeleton-card" *ngFor="let i of [1, 2, 3, 4, 5]">
            <div class="skeleton skeleton-avatar"></div>
            <div class="skeleton-info">
              <div class="skeleton skeleton-text"></div>
              <div class="skeleton skeleton-text" style="width: 70%"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="student-panel selected-panel">
        <div class="panel-header">
          <div class="skeleton skeleton-text" style="width: 40%"></div>
        </div>
        <div class="student-list">
          <div class="skeleton-card" *ngFor="let i of [1, 2, 3]">
            <div class="skeleton skeleton-avatar"></div>
            <div class="skeleton-info">
              <div class="skeleton skeleton-text"></div>
              <div class="skeleton skeleton-text" style="width: 70%"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="actions-section">
      <div class="skeleton skeleton-input" style="width: 220px"></div>
      <div class="skeleton skeleton-button"></div>
    </div>
  </div>
</ng-template>

<ng-template #emptyAvailableState>
  <div class="state-placeholder">
    <p>Không tìm thấy học sinh nào.</p>
  </div>
</ng-template>

<ng-template #emptySelectedState>
  <div class="state-placeholder">
    <p>
      Chưa chọn học sinh nào.<br />Nhấn vào học sinh trong danh sách để thêm.
    </p>
  </div>
</ng-template>
