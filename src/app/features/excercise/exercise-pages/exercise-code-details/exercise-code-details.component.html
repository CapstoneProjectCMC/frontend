<div class="coding-details-container" *ngIf="exercise">
  <div class="problem-description">
    <h1 class="title">{{ exercise.title }}</h1>

    <div class="meta-header">
      <span
        class="difficulty-badge"
        [ngClass]="'difficulty-' + exercise.difficulty.toLowerCase()"
      >
        {{ exercise.difficulty }}
      </span>
      <span class="status-tag" *ngIf="exercise.active">
        <i class="fa fa-circle"></i> Hoạt động
      </span>
    </div>

    <div class="section">
      <h2 class="section-title">Mô tả bài toán</h2>
      <p [innerHTML]="exercise.description"></p>
    </div>

    <div class="section">
      <h2 class="section-title">Định dạng đầu vào (Input)</h2>
      <pre><code>{{ exercise.codingDetail.input }}</code></pre>
    </div>

    <div class="section">
      <h2 class="section-title">Định dạng đầu ra (Output)</h2>
      <pre><code>{{ exercise.codingDetail.output }}</code></pre>
    </div>

    <div class="section">
      <h2 class="section-title">Các ràng buộc (Constraints)</h2>
      <pre><code>{{ exercise.codingDetail.constraintText }}</code></pre>
    </div>

    <div class="section">
      <h2 class="section-title">Ví dụ (Sample Test Cases)</h2>
      <div
        *ngFor="let testCase of getSampleTestCases(); let i = index"
        class="test-case"
      >
        <h3 class="test-case-title">Ví dụ {{ i + 1 }}</h3>
        <div class="io-block">
          <label>Input:</label>
          <pre><code>{{ testCase.input }}</code></pre>
        </div>
        <div class="io-block">
          <label>Output:</label>
          <pre><code>{{ testCase.expectedOutput }}</code></pre>
        </div>
        <p class="note" *ngIf="testCase.note">
          <strong>Giải thích:</strong> {{ testCase.note }}
        </p>
      </div>
    </div>
  </div>

  <aside class="problem-info">
    <div class="info-card">
      <ul class="info-list">
        <li>
          <span><i class="fa fa-clock"></i> Giới hạn thời gian</span>
          <strong>{{ exercise.codingDetail.timeLimit }}s</strong>
        </li>
        <li>
          <span><i class="fa fa-memory"></i> Giới hạn bộ nhớ</span>
          <strong>{{ exercise.codingDetail.memoryLimit }} MB</strong>
        </li>
        <li>
          <span><i class="fa fa-upload"></i> Lượt nộp tối đa</span>
          <strong>{{ exercise.codingDetail.maxSubmissions }}</strong>
        </li>
        <li>
          <span><i class="fa fa-hourglass-half"></i> Thời gian làm bài</span>
          <strong>{{ exercise.duration }} phút</strong>
        </li>
      </ul>
    </div>

    <div class="info-card">
      <h3 class="card-title">Ngôn ngữ được phép</h3>
      <div class="tags-container">
        <span
          *ngFor="let lang of exercise.codingDetail.allowedLanguages"
          class="language-tag"
        >
          {{ lang }}
        </span>
      </div>
    </div>

    <div class="info-card">
      <h3 class="card-title">Tags</h3>
      <div class="tags-container">
        <span *ngFor="let tag of exercise.tags" class="tag">{{ tag }}</span>
      </div>
    </div>

    <div class="action-buttons">
      <button class="btn btn-secondary" (click)="goBack()">Quay lại</button>
      <button class="btn btn-warning" (click)="openUpdateModal()">
        Chỉnh sửa
      </button>
      <button class="btn btn-primary">Bắt đầu làm</button>
    </div>
  </aside>
</div>

<div class="loading" *ngIf="!exercise"></div>

<!-- Update Modal -->
<app-update-code-details
  [codingDetail]="exercise?.codingDetail || null"
  [isVisible]="isUpdateModalVisible"
  (closeModal)="closeUpdateModal()"
  (saveChanges)="onSaveCodingDetails($event)"
></app-update-code-details>
