<div class="submission-container" #submissionContainer>
  <div class="left-panel" #leftPanel>
    <div class="panel-tabs">
      <button
        class="tab-item"
        [class.active]="activeLeftTab === 'description'"
        (click)="selectLeftTab('description')"
      >
        Description
      </button>
      <button
        class="tab-item"
        [class.active]="activeLeftTab === 'testcases'"
        (click)="selectLeftTab('testcases')"
      >
        Test Cases
      </button>
    </div>

    <div class="panel-content" *ngIf="activeLeftTab === 'description'">
      <div class="problem-header">
        <h2>{{ exercise?.title }}</h2>
        <span
          class="difficulty"
          [ngClass]="exercise?.difficulty?.toLowerCase()"
        >
          {{ exercise?.difficulty }}
        </span>
      </div>
      <div
        class="problem-description"
        [innerHTML]="exercise?.description"
      ></div>
      <div class="examples" *ngFor="let example of examples; let i = index">
        <h4>Example {{ i + 1 }}</h4>
        <pre><strong>Input:</strong> {{ example.input }}</pre>
        <pre><strong>Output:</strong> {{ example.output }}</pre>
      </div>
    </div>

    <div class="panel-content" *ngIf="activeLeftTab === 'testcases'">
      <div
        class="submission-summary"
        *ngIf="submissionResult"
        [ngClass]="submissionResult.passedAll ? 'success' : 'failure'"
      >
        <div
          class="summary-status"
          [ngClass]="submissionResult.passedAll ? 'success' : 'failure'"
        >
          <i
            class="fa"
            [ngClass]="
              submissionResult.passedAll ? 'fa-check-circle' : 'fa-times-circle'
            "
          ></i>
          <span>{{
            submissionResult.passedAll ? "Accepted" : "Wrong Answer"
          }}</span>
        </div>
        <div class="summary-details">
          <div class="detail-item">
            <span class="label">Score</span>
            <span class="value"
              >{{ submissionResult.score }} /
              {{ submissionResult.totalPoints }}</span
            >
          </div>
          <div class="detail-item">
            <span class="label">Peak Memory</span>
            <span class="value"
              >{{ (submissionResult.peakMemoryKb / 1024).toFixed(2) }} MB</span
            >
          </div>
        </div>
      </div>

      <h4 *ngIf="!submissionResult">Test Cases</h4>
      <div class="test-case-grid">
        <div
          *ngFor="let tc of testCases; let i = index"
          class="test-case-item"
          [ngClass]="tc.status"
        >
          <div class="case-header">
            <div class="status-icon">
              <i
                *ngIf="tc.status === 'pass' && !isSubmitting"
                class="fa fa-check"
              ></i>
              <i
                *ngIf="
                  (tc.status === 'fail' && !isSubmitting) ||
                  (tc.status === 'error' && !isSubmitting)
                "
                class="fa fa-times"
              ></i>
              <i
                *ngIf="tc.status === 'pending' && isSubmitting"
                class="fa fa-spinner fa-spin"
              ></i>
            </div>
            <span class="case-title">Test Case #{{ i + 1 }}</span>
            <span class="status-text">{{ tc.status | uppercase }}</span>
          </div>

          <div class="case-body" *ngIf="tc.status !== 'pending'">
            <div class="case-metrics">
              <span><i class="fa fa-clock"></i> {{ tc.runtimeMs }} ms</span>
              <span *ngIf="tc.memoryKb"
                ><i class="fa fa-memory"></i>
                {{ (tc.memoryKb / 1024).toFixed(2) }} MB</span
              >
            </div>

            <div *ngIf="tc.status === 'error'" class="error-message">
              <strong>Error:</strong>
              <pre>{{ tc.errorMessage }}</pre>
            </div>

            <div *ngIf="tc.status === 'fail'" class="io-details">
              <div>
                <b>Input:</b> <code>{{ tc.input }}</code>
              </div>
              <div>
                <b>Expected:</b> <code>{{ tc.expected }}</code>
              </div>
              <div>
                <b>Your Output:</b>
                <code>{{ tc.actualOutput ? tc.actualOutput : "ERROR" }}</code>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="resizer" #resizer (mousedown)="onMouseDown($event)"></div>

  <div class="right-panel">
    <div class="editor-wrapper">
      <app-code-editor class="code-editor"></app-code-editor>
    </div>

    <div class="console-wrapper">
      <div class="console-header">
        <span>Console</span>
        <div class="editor-controls">
          <button
            class="control-btn"
            (click)="runCode()"
            [disabled]="isRunning || isSubmitting"
          >
            <i class="fa fa-play"></i> Chạy thử
          </button>
          <button
            class="control-btn submit"
            (click)="submitCode()"
            [disabled]="isRunning || isSubmitting"
          >
            <i class="fa-solid fa-paper-plane"></i> Submit
          </button>
        </div>
      </div>
      <div class="console-content">
        <div class="metrics" *ngIf="!isRunning">
          <span>Time: {{ executionTime }}ms</span>
          <span>Memory: {{ memoryUsage }}MB</span>
        </div>
        <pre [ngClass]="{ error: hasError }">{{ output }}</pre>
      </div>
    </div>
  </div>
</div>
