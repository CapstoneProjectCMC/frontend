<div
  class="change-password-modal-overlay"
  [class.open]="isVisibleModal"
  (click)="onClose()"
  >
  <div
    class="change-password-modal"
    [class.open]="isVisibleModal"
    (click)="$event.stopPropagation()"
    >
    <div class="modal-header">
      <span class="modal-title">Đổi Mật Khẩu</span>
      <button class="modal-close-button" (click)="onClose()">
        <i class="fa fa-times"></i>
      </button>
    </div>

    <div class="modal-body">
      <!-- Mật khẩu cũ -->
      <div class="input-group">
        <label for="old-password">Mật khẩu cũ</label>
        <div class="input-container">
          <input
            id="old-password"
            [type]="isOldPasswordVisible ? 'text' : 'password'"
            placeholder="Nhập mật khẩu cũ của bạn"
            [(ngModel)]="oldPassword"
            (input)="oldPasswordError = ''"
            />
            <span
              class="toggle-password"
              (click)="togglePasswordVisibility('old')"
              >
              <i
                class="fa"
                [ngClass]="isOldPasswordVisible ? 'fa-eye-slash' : 'fa-eye'"
              ></i>
            </span>
          </div>
          @if (oldPasswordError) {
            <div class="error-message">
              {{ oldPasswordError }}
            </div>
          }
        </div>

        <!-- Mật khẩu mới -->
        <div class="input-group">
          <label for="new-password">Mật khẩu mới</label>
          <div class="input-container">
            <input
              id="new-password"
              [type]="isNewPasswordVisible ? 'text' : 'password'"
              placeholder="Nhập mật khẩu mới của bạn"
              [(ngModel)]="newPassword"
              (input)="checkPasswordStrength()"
              />
              <span
                class="toggle-password"
                (click)="togglePasswordVisibility('new')"
                >
                <i
                  class="fa"
                  [ngClass]="isNewPasswordVisible ? 'fa-eye-slash' : 'fa-eye'"
                ></i>
              </span>
            </div>

            <!-- Thanh strength -->
            <div class="password-strength-container">
              <div
                class="password-strength-bar"
                [style.width]="passwordStrength + '%'"
                [ngClass]="getStrengthClass()"
              ></div>
              <div class="requirements-list">
                <span [class.valid]="hasLength">Tối thiểu 8 ký tự</span>
                <span [class.valid]="hasUppercase">Có ít nhất 1 chữ hoa</span>
                <span [class.valid]="hasLowercase">Có ít nhất 1 chữ thường</span>
                <span [class.valid]="hasNumber">Có ít nhất 1 số</span>
                <span [class.valid]="hasSpecialChar"
                  >Có ít nhất 1 ký tự đặc biệt</span
                  >
                </div>
              </div>
            </div>

            <!-- Nhập lại mật khẩu -->
            <div class="input-group">
              <label for="confirm-password">Nhập lại mật khẩu mới</label>
              <div class="input-container">
                <input
                  id="confirm-password"
                  [type]="isConfirmPasswordVisible ? 'text' : 'password'"
                  placeholder="Nhập lại mật khẩu mới"
                  [(ngModel)]="confirmPassword"
                  (input)="confirmPasswordError = ''"
                  />
                  <span
                    class="toggle-password"
                    (click)="togglePasswordVisibility('confirm')"
                    >
                    <i
                      class="fa"
                      [ngClass]="isConfirmPasswordVisible ? 'fa-eye-slash' : 'fa-eye'"
                    ></i>
                  </span>
                </div>
                @if (confirmPasswordError) {
                  <div class="error-message">
                    {{ confirmPasswordError }}
                  </div>
                }
              </div>
            </div>

            <!-- Footer -->
            <div class="modal-footer">
              <button class="btn btn-outline" (click)="onClose()">Hủy</button>
              <button
                class="btn btn-primary"
                (click)="onChangePassword()"
                [disabled]="!isFormValid() || isLoading"
                >
                @if (!isLoading) {
                  <span>Đổi mật khẩu</span>
                }
                @if (isLoading) {
                  <span class="loader"></span>
                }
              </button>
            </div>
          </div>
        </div>
