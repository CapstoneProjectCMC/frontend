<div class="block-details-page">
  <div class="block-header-section">
    <div class="info-block">
      <h1>{{ block.name }}</h1>
      <div class="meta-info">
        <span class="code">Mã: {{ block.code }}</span>
      </div>
      <p class="description">{{ block.description }}</p>
    </div>
    <div class="actions">
      <button class="btn-primary" (click)="openModalAdd()">
        <i class="fas fa-user-plus"></i> Thêm thành viên
      </button>
    </div>
  </div>

  <hr class="divider" />

  <div class="members-section">
    <div class="members-header">
      <h2>Thành viên ({{ members.length }})</h2>
      <div class="search-box">
        <input type="text" placeholder="Tìm kiếm thành viên..." />
        <i class="fas fa-search"></i>
      </div>
    </div>

    <div class="members-list" appScrollEnd (appScrollEnd)="onScrollEnd()">
      @for (m of members; track m) {
        <div
          class="member-card"
          [class.inactive]="!m.active"
          >
          <img
            [src]="m.user.avatarUrl || avatarDefault"
            alt="avatar"
            class="avatar"
            />
            <div class="member-info">
              <div class="name-status">
                <span class="name">{{ m.user.displayName }}</span>
                <span class="status-dot" [class.active]="m.active"></span>
              </div>
              <div class="email">{{ m.user.email }}</div>
            </div>
            <div class="role-badge">
              @if (m.role === 'ADMIN') {
                <i class="fas fa-crown"></i>
              }
              {{ m.role }}
            </div>
            <div class="member-actions">
              <button
                class="btn-remove"
                (click)="openModalConfirmDelete(m.user.userId)"
                >
                <i class="fas fa-trash-alt"></i>
              </button>
            </div>
          </div>
        }
        @if (isLoading) {
          <div class="loading">Đang tải...</div>
        }
      </div>
    </div>

    <app-modal-add-user-to-block
      [isOpen]="isAddUserOpen"
      [blockId]="blockId"
      (closed)="isAddUserOpen = false"
      (saved)="reloadMembers()"
    ></app-modal-add-user-to-block>
  </div>
