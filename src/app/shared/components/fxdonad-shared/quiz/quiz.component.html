<div class="quiz-container">
  <div class="quiz-sidebar">
    <div class="time-section">
      <div><strong>Time:</strong> {{ timeLeft | durationFormat }}</div>
      <div
        class="progress-bar time"
        [style.width.%]="timeProgress"
        [ngClass]="{
          danger: timeLeft / totalTime <= 0.2,
          warning: timeLeft / totalTime <= 0.5 && timeLeft / totalTime > 0.2,
          safe: timeLeft / totalTime > 0.5
        }"
      ></div>
    </div>
    <div class="done-section">
      <div><strong>Done:</strong> {{ doneCount }}/{{ questions.length }}</div>
      <div class="progress-bar done" [style.width.%]="doneProgress"></div>
    </div>

    <ul class="question-list">
      @for (question of questions; track question; let i = $index) {
      <li [class.done]="question.done" (click)="goToQuestion(i)">
        Câu {{ i + 1 }}
      </li>
      }
    </ul>
  </div>

  @if (questions.length) {
  <div class="quiz-main">
    <div class="content-quiz-container">
      <div class="question-number">Câu {{ currentQuestionIndex + 1 }}:</div>
      <div class="question-text">
        <strong>{{ questions[currentQuestionIndex].text }}</strong>
      </div>
      <div class="options">
        @for (opt of questions[currentQuestionIndex].options; track opt) {
        <label
          class="option"
          [class.selected]="isOptionSelected(currentQuestionIndex, opt.id)"
        >
          @if ( questions[currentQuestionIndex].questiontype === 'MULTI_CHOICE')
          {
          <input
            type="checkbox"
            [checked]="isOptionSelected(currentQuestionIndex, opt.id)"
            (change)="selectAnswer(currentQuestionIndex, opt)"
          />
          } @else {
          <input
            type="radio"
            name="answer{{ currentQuestionIndex }}"
            [checked]="isOptionSelected(currentQuestionIndex, opt.id)"
            (change)="selectAnswer(currentQuestionIndex, opt)"
          />
          }
          {{ opt.optiontext }}
        </label>
        }
      </div>
      <div class="buttons">
        <div class="control-btn">
          <button
            class="btn-prev"
            (click)="prevQuestion()"
            [disabled]="currentQuestionIndex === 0"
          >
            Câu trước
          </button>
          <button
            class="btn-next"
            (click)="nextQuestion()"
            [disabled]="currentQuestionIndex >= questions.length - 1"
          >
            Câu tiếp
          </button>
        </div>
        <button class="btn-submit" (click)="openModalConfirm()">Nộp bài</button>
      </div>
    </div>
  </div>
  }
</div>
