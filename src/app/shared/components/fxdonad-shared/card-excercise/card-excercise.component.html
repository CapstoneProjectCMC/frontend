<div class="excercise-card-container">
  <div class="info-card" [class.border]="role !== 'admin'">
    <div class="card-header">
      <h2 class="title" [title]="data.title" (click)="onTitleClick()">
        {{ data.title | truncate : 30 }}
      </h2>
    </div>

    <div class="metadata">
      <div class="uploader-info">
        <img
          [src]="
            data.uploader.avatar ||
            'https://images.unsplash.com/photo-1633332755192-727a05c4013d?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=50&h=50'
          "
          [alt]="data.uploader.name"
          class="avatar"
          (error)="handleImageError($event)"
        />
        <span class="username">{{ data.uploader.name }}</span>
      </div>
      <div class="timestamp" [title]="data.uploadTime | date : 'full'">
        {{ data.uploadTime | date : "medium" }}
      </div>
    </div>

    <div class="description">
      <p [class.clamp-2-lines]="!isExpanded" [class.expanded]="isExpanded">
        {{ data.description }}
      </p>
      <button
        *ngIf="data.description.length > 100"
        (click)="toggleDescription()"
        class="read-more"
      >
        {{ isExpanded ? "Read Less" : "Read More" }}
      </button>
    </div>

    <div
      class="difficulty"
      [attr.aria-label]="'Difficulty: ' + data.difficulty"
    >
      <div class="part-difficulty">
        <div class="difficulty-badge" [ngClass]="data.difficulty">
          {{
            data.difficulty === "EASY"
              ? "Dễ"
              : data.difficulty === "MEDIUM"
              ? "Trung bình"
              : data.difficulty === "HARD"
              ? "Khó"
              : (data.difficulty | titlecase)
          }}
        </div>
        <div class="difficulty-stars">
          <!-- <span
            class="star"
            *ngFor="let star of difficultyStars"
            [class.filled]="star <= difficultyLevel"
          >
            ★
          </span> -->
        </div>
      </div>
      <div class="part-type-ex">
        <i
          [ngClass]="
            data.type === 'CODING'
              ? 'fas fa-code'
              : 'fa-regular fa-circle-check'
          "
        ></i>
        {{ data.type === "CODING" ? "Viết mã" : "Trắc nghiệm" }}
      </div>
    </div>

    <div class="tags-container">
      <div class="tags-scroll">
        <span
          class="tag"
          *ngFor="let tag of data.tags"
          (click)="onTagClick(tag)"
          [attr.aria-label]="'Tag: ' + tag"
        >
          #{{ tag }}
        </span>
      </div>
    </div>

    <div class="actions">
      <!-- <div class="status-toggle">
        <button
          class="toggle-btn"
          [class.completed]="data.status === 'completed'"
          (click)="toggleStatus()"
          [attr.aria-label]="'Toggle status: Currently ' + data.status"
        >
          <span class="toggle-icon">{{
            data.status === "completed" ? "✓" : "⧖"
          }}</span>
          {{ data.status | titlecase }}
        </button>
      </div> -->
      <button
        class="save-btn"
        [class.saved]="isSaved"
        (click)="toggleSave()"
        aria-label="Save item"
      >
        <span class="save-icon">{{ isSaved ? "★" : "☆" }}</span>
      </button>
    </div>
  </div>

  <div
    class="admin-actions"
    [class.accepted]="data.approval === 'accepted'"
    [class.pending]="data.approval === 'pending'"
    [class.rejected]="data.approval === 'rejected'"
    *ngIf="role === 'admin'"
  >
    <button
      class="delete-btn"
      (click)="onDelete()"
      *ngIf="data.approval !== 'pending'"
    >
      <i class="fas fa-trash"></i>
    </button>
    <button
      class="edit-btn"
      (click)="onEdit()"
      *ngIf="data.approval !== 'pending'"
    >
      <i class="fas fa-edit"></i>
    </button>

    <ng-container *ngIf="data.approval === 'pending'">
      <button class="accept-btn" (click)="onApprove('accepted')">
        Chấp nhận
      </button>
      <button class="reject-btn" (click)="onApprove('rejected')">
        Từ chối
      </button>
    </ng-container>
  </div>
</div>
