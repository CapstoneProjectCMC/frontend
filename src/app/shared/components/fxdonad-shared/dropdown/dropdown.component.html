<div class="dropdown-container" [class.disabled]="disabled">
  @if (title_label) {
    <div class="title-label">{{ title_label }}</div>
  }

  <button
    class="dropdown-button"
    [class.open]="isOpen"
    [class.primary]="variant === 'primary'"
    [class.secondary]="variant === 'secondary'"
    [class.outlined]="variant === 'outlined'"
    [class.text]="variant === 'text'"
    [class.small]="size === 'small'"
    [class.medium]="size === 'medium'"
    [class.large]="size === 'large'"
    [attr.aria-expanded]="isOpen"
    [attr.aria-disabled]="disabled"
    (click)="toggleDropdown($event)"
    (keydown)="handleKeydown($event)"
    (click)="onToggle()"
    role="button"
    [type]="typeSubmit"
    tabindex="0"
    #dropdownButton
    >
    <span class="button-label">
      <span class="chip-list">
        @if (multiSelect) {
          @for (selected of selectedOptions; track selected) {
            <span class="chip">
              {{ selected.label }}
              <button
                type="button"
                class="chip-remove"
                (click)="removeSelectedOption(selected, $event)"
                aria-label="Remove"
                >
                ×
              </button>
            </span>
          }
          @if (selectedOptions.length === 0) {
            {{ label }}
          }
        } @else {
          {{ truncateString(selectedLabels, 12) }}
        }
      </span>
    </span>

    <span class="arrow-icon" [class.open]="isOpen">
      <img
        src="icon-assets/icon-dropdown.png"
        alt=""
        class="icon-dropdown"
        [class.small]="size === 'small'"
        [class.medium]="size === 'medium'"
        [class.large]="size === 'large'"
        />
      </span>
    </button>

    <div
      class="dropdown-menu"
      [class.min-height]="minHeight"
      [class.main-type]="customDropField === 'main-type'"
      [class.second-type]="customDropField === 'second-type'"
      [class.third-type]="customDropField === 'third-type'"
      [class.four-type]="customDropField === 'four-type'"
      [class.open]="isOpen"
      role="listbox"
      [attr.inert]="!isOpen ? true : null"
      #dropdownMenu
      >
      @if (isSearchable) {
        <input
          type="text"
          class="search-input"
          [(ngModel)]="searchTerm"
          placeholder="Tìm kiếm..."
          (input)="filterOptions()"
          (keydown)="handleKeydown($event)"
          />
      }

      @if (isButtonControl) {
        <div class="btn-control">
          <div class="btn-area">
            <app-interactive-button
              [buttonText]="'Huỷ hết'"
              [buttonType]="'primary'"
              [buttonSize]="'small'"
              [isDisabled]="false"
              [iconName]="''"
              [tooltipText]="'Nhấn để xác nhận'"
              (buttonClick)="handleCancel($event)"
              (buttonHover)="handleHover($event)"
              (buttonFocus)="handleFocus($event)"
            ></app-interactive-button>
          </div>
        </div>
      }

      <div
        [class.opened]="isOpen"
        class="list-options"
        [class.small]="size === 'small'"
        [class.medium]="size === 'medium'"
        [class.large]="size === 'large'"
        >
        <!-- Hiển thị thông báo nếu không tìm thấy kết quả và có từ khóa tìm kiếm -->
        @if (filteredOptions.length === 0 && searchTerm) {
          <div
            class="no-options"
            [class.small]="size === 'small'"
            [class.medium]="size === 'medium'"
            [class.large]="size === 'large'"
            >
            Không tìm thấy kết quả
          </div>
        }

        <!-- Chỉ hiển thị danh sách nếu có item -->
        @if (filteredOptions.length > 0 || !searchTerm) {
          @for (
            option of filteredOptions.length > 0
            ? filteredOptions
            : options; track
            option; let i = $index) {
            <div
              class="dropdown-item"
              [class.disabled]="option.disabled"
              [class.selected]="isSelected(option) && needIndexColor"
              (click)="selectOption(option, i)"
              [class.small]="size === 'small'"
              [class.medium]="size === 'medium'"
              [class.large]="size === 'large'"
              >
              <div
                class="label-dropdown-item"
                [class.small]="size === 'small'"
                [class.medium]="size === 'medium'"
                [class.large]="size === 'large'"
                >
                @if (isDisplayCheckbox) {
                  <input
                    type="checkbox"
                    [checked]="isSelected(option)"
                    (click)="$event.stopPropagation()"
                    />
                }
                {{ option.label }}
              </div>
            </div>
          }
        }
      </div>
    </div>
  </div>
